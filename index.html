<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-dark.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <title>Giploy by remiheens</title>
  </head>

  <body>

    <header>
      <div class="container">
        <h1>Giploy</h1>
        <h2>giploy is another script to deploy git master branch on multiple remote server.</h2>

        <section id="downloads">
          <a href="https://github.com/remiheens/giploy/zipball/master" class="btn">Download as .zip</a>
          <a href="https://github.com/remiheens/giploy/tarball/master" class="btn">Download as .tar.gz</a>
          <a href="https://github.com/remiheens/giploy" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <h1>
<a id="giploy" class="anchor" href="#giploy" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>giploy</h1>

<p>giploy is another script to deploy git master branch on remote server. The particularity of giploy is that it doesn't create tag or symbolic link on remote server like capistrano, so you don't have to extract or copy users uploaded files from your directory after deployement. It pulls source from develop branch on a git repository and create a release branch to bump the version and merge on master before pushing on remote server. It works like <a href="http://jeffkreeftmeijer.com/2010/why-arent-you-using-git-flow/">git-flow</a> works. </p>

<p>It's very usefull if you don't want to hook a push on master to deploy automatically but you want to manage your deployment schedulation.</p>

<pre><code>Deployment server ------- www1
                     \--- www2
</code></pre>

<h2>
<a id="install" class="anchor" href="#install" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Install</h2>

<p>Download the giploy.sh and giploy.conf</p>

<pre><code>$ vim giploy.conf
$ chmod +x giploy.sh
$ ./giploy.sh -h
</code></pre>

<h2>
<a id="configuration" class="anchor" href="#configuration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Configuration</h2>

<table>
<thead>
<tr>
<th>key</th>
<th>sample value</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>REPOSITORY</td>
<td>/home/&lt;user&gt;/preprod</td>
<td>The absolute path of your deployement git directory on your deployement server</td>
</tr>
<tr>
<td>REMOTES</td>
<td>"production,production2"</td>
<td>Remote name list</td>
</tr>
<tr>
<td>LOG_FILENAME</td>
<td>debug.log</td>
<td>The log filename</td>
</tr>
<tr>
<td>SCRIPT_ON_RELEASE_BRANCH</td>
<td>custom.sh</td>
<td>If you want to run a custom script when giploy is on the release branch</td>
</tr>
</tbody>
</table>

<h2>
<a id="add-remote-server" class="anchor" href="#add-remote-server" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Add remote server</h2>

<h3>
<a id="automatically" class="anchor" href="#automatically" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Automatically</h3>

<p>Juste download init-remote.sh next to giploy.sh and run</p>

<pre><code>$ ./init-remote.sh -u vagrant -H 127.0.0.1 -p 2201 -r /home/vagrant/website production3
</code></pre>

<h3>
<a id="manually" class="anchor" href="#manually" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Manually</h3>

<h4>
<a id="on-remote-server" class="anchor" href="#on-remote-server" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>on remote server</h4>

<p>Create empty git repository</p>

<pre><code>$ mkdir -p /home/&lt;user&gt;/&lt;project&gt;.git
$ cd /home/&lt;user&gt;/&lt;project&gt;.git
$ git init --bare
</code></pre>

<p>Create the hook that checkout pushed branch</p>

<pre><code>$ vim hooks/post-receive
#!/bin/sh 
GIT_WORK_TREE=/var/www/&lt;project&gt; git checkout -f
</code></pre>

<p>Make sure that your hook have corrects rights</p>

<pre><code>$ chmod +x hooks/post-receive
</code></pre>

<h4>
<a id="on-deploymentdev-server" class="anchor" href="#on-deploymentdev-server" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>on deployment/dev server</h4>

<p>In your repository path, you have to add a remote server to use this script.</p>

<pre><code>$ cd &lt;repository-path&gt;
$ git remote add production ssh://&lt;website.com&gt;/home/&lt;user&gt;/&lt;project&gt;.git
</code></pre>

<p>Do an initial push, that setup the master branch</p>

<pre><code>$ git push production +master:refs/heads/master
</code></pre>

<p>So, you're ready to use this remote server and add it to giploy.conf</p>

<p>Enjoy</p>

<h2>
<a id="share-ssh-key-with-remote-server" class="anchor" href="#share-ssh-key-with-remote-server" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Share SSH Key with remote server</h2>

<p>If you have many remote server, you probably want to share ssh key to avoid password typing for each server.
Go to your deployement/dev server and type this command <code>ssh-keygen</code>if you don't have a <code>~/.ssh/id_rsa</code> file
Now, it's time to copy your public key to your remote server : </p>

<pre><code>$ ssh-copy-id &lt;user&gt;@&lt;website.com&gt;
</code></pre>

<p>To validate installation, try to login to your remote server and if it doesn't ask for password, ssh key was correctly installed.</p>
      </section>
    </div>

    
  </body>
</html>
